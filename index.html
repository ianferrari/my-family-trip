<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Travel OS Pro Debug</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
    <script>
        var vConsole = new VConsole();
        console.log("Debug Mode Started");
    </script>

    <style>
        :root {
            --bg-color: #F2F2F7;
            --text-primary: #1C1C1E;
            --header-bg: rgba(255, 255, 255, 0.95);
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #000000;
                --text-primary: #FFFFFF;
                --header-bg: rgba(28, 28, 30, 0.95);
            }
        }
        body { font-family: -apple-system, sans-serif; background: var(--bg-color); color: var(--text-primary); margin: 0; padding: 0; padding-bottom: 100px;}
        header { position: sticky; top: 0; background: var(--header-bg); padding: 15px; border-bottom: 1px solid #ccc; z-index: 100; text-align: center; }
        #status { text-align: center; padding: 10px; color: #888; }
        #map { width: 100%; height: 40vh; background: #ddd; margin-bottom: 20px; }
        .error-box { background: #FF3B30; color: white; padding: 15px; margin: 10px; border-radius: 10px; display: none; }
        .tab-btn { padding: 10px 20px; font-size: 16px; margin: 5px; }
    </style>
</head>
<body>

<header>
    <h1>Travel OS (除錯版)</h1>
</header>

<div id="error-msg" class="error-box"></div>

<div id="status">正在嘗試連線 Google Maps...</div>
<div id="map"></div>

<div style="text-align: center;">
    <button class="tab-btn" onclick="checkAPI()">按我檢查 API 狀態</button>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyaGpwDguvqVwYGPN1CsVbuddU18dtHEs&loading=async&libraries=places,maps&callback=initMap" onerror="handleApiError()"></script>

<script>
    let map;

    // 捕捉 API 載入失敗
    function handleApiError() {
        const msg = "❌ Google Maps 無法載入！請檢查您的網路或 API Key 是否正確。";
        console.error(msg);
        showError(msg);
    }

    function showError(text) {
        const box = document.getElementById('error-msg');
        box.style.display = 'block';
        box.innerHTML += `<p>${text}</p>`;
        document.getElementById('status').innerText = "發生錯誤";
    }

    // 地圖初始化
    async function initMap() {
        console.log("initMap triggered");
        document.getElementById('status').innerText = "API 載入成功，正在繪製地圖...";
        
        try {
            const { Map } = await google.maps.importLibrary("maps");
            map = new Map(document.getElementById("map"), {
                center: { lat: 25.0478, lng: 121.5170 }, // 台北車站
                zoom: 15,
                mapId: "DEMO_MAP_ID"
            });
            document.getElementById('status').innerText = "地圖繪製完成！(請按綠色按鈕檢查詳細錯誤)";
            console.log("Map rendered successfully");
        } catch (e) {
            console.error(e);
            showError("地圖繪製失敗：" + e.message);
        }
    }

    function checkAPI() {
        if (typeof google === 'undefined') {
            showError("Google 物件不存在 (API Key 可能無效)");
        } else {
            alert("Google API 已載入！如果地圖還是灰的，請檢查 vConsole 的紅色錯誤。");
        }
    }
</script>
</body>
</html>
