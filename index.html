<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¦ªå­æ™ºæ…§å°éŠ (å…¨çƒç‰ˆ)</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 0;
            color: #333;
        }

        /* --- é ‚éƒ¨å°èˆªåˆ— --- */
        header {
            background-color: #00bcd4; /* å……æ»¿æ´»åŠ›çš„è—è‰² */
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        header h1 { margin: 0; font-size: 1.2rem; }
        header p { margin: 5px 0 0; font-size: 0.8rem; opacity: 0.9; }

        /* --- æ§åˆ¶å€ --- */
        .controls {
            padding: 15px;
            text-align: center;
            background: white;
            border-bottom: 1px solid #eee;
        }
        
        button#find-btn {
            background-color: #ff9800; /* é¡¯çœ¼çš„æ©˜è‰² */
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        button#find-btn:active { transform: scale(0.95); }
        button#find-btn:disabled { background-color: #ccc; }

        #status {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        /* --- åœ°åœ–å€å¡Š --- */
        #map {
            width: 100%;
            height: 30vh; /* åœ°åœ–ä½”ç•«é¢çš„ 30% */
            background-color: #e0e0e0;
        }

        /* --- æ™¯é»åˆ—è¡¨å€ --- */
        .results-container {
            padding: 15px;
            max-width: 800px;
            margin: 0 auto;
        }

        .place-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .place-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .place-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }

        .place-rating {
            background: #fff3cd;
            color: #856404;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .place-info {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.4;
        }

        .open-now { color: #28a745; font-weight: bold; }
        .closed-now { color: #dc3545; font-weight: bold; }

        /* --- çˆ¸åª½å°ˆå±¬è³‡è¨Šå€ (æ¨¡æ“¬ AI åˆ†æ) --- */
        .parent-tips {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px;
            margin-top: 5px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        .parent-tips strong { display: block; margin-bottom: 3px; color: #1565c0; }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        .tag {
            background: #f0f0f0;
            color: #666;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 10px;
        }

    </style>
</head>
<body>

<header>
    <h1>ğŸŒ çˆ¸åª½çš„æ—…éŠç¥éšŠå‹</h1>
    <p>ä¸ç®¡åœ¨å°ç£é‚„æ˜¯ä¸–ç•Œå„åœ°ï¼Œä¸€éµæ‰¾å¥½ç©ï¼</p>
</header>

<div class="controls">
    <button id="find-btn" onclick="startExplore()">ğŸ“ æœå°‹é™„è¿‘ç†±é–€æ™¯é»</button>
    <div id="status">æº–å‚™å°±ç·’</div>
</div>

<div id="map"></div>

<div class="results-container" id="results">
    <p style="text-align:center; color:#999; margin-top:30px;">
        é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¢ç´¢...
    </p>
</div>

<script>
    let map;
    let service;
    let infowindow;
    let userLocation = null;

    // 1. åˆå§‹åŒ–åœ°åœ– (é è¨­å…ˆä¸é¡¯ç¤ºè©³ç´°ä½ç½®)
    function initMap() {
        // é è¨­ä½ç½®å…ˆå®šåœ¨å°ç£ä¸­å¿ƒï¼Œæˆ–ä»»ä½•åœ°æ–¹
        const defaultLoc = { lat: 23.973875, lng: 120.982024 };
        
        map = new google.maps.Map(document.getElementById("map"), {
            center: defaultLoc,
            zoom: 7, // é¡¯ç¤ºæ•´å€‹å°ç£
            disableDefaultUI: true // ç°¡åŒ–ä»‹é¢
        });

        infowindow = new google.maps.InfoWindow();
    }

    // 2. é–‹å§‹æ¢ç´¢æŒ‰éˆ•è§¸ç™¼
    function startExplore() {
        const statusDiv = document.getElementById('status');
        const btn = document.getElementById('find-btn');
        
        statusDiv.innerHTML = "ğŸ“¡ æ­£åœ¨å®šä½ä¸­ï¼Œè«‹ç¨å€™...";
        btn.disabled = true;

        // ä½¿ç”¨ç€è¦½å™¨å®šä½
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                    };

                    statusDiv.innerHTML = "âœ… å®šä½æˆåŠŸï¼æ­£åœ¨æœå°‹é™„è¿‘å¥½ç©çš„åœ°æ–¹...";
                    
                    // åœ°åœ–ç§»å‹•åˆ°è©²ä½ç½®
                    map.setCenter(userLocation);
                    map.setZoom(15);
                    
                    // åœ¨åœ°åœ–ä¸Šæ¨™è¨˜ã€Œæˆ‘åœ¨é€™ã€
                    new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: "ä½ çš„ä½ç½®",
                        icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                    });

                    // åŸ·è¡Œæœå°‹
                    searchNearbyPlaces(userLocation);
                    btn.disabled = false;
                },
                () => {
                    handleLocationError(true, statusDiv);
                    btn.disabled = false;
                }
            );
        } else {
            // ç€è¦½å™¨ä¸æ”¯æ´
            handleLocationError(false, statusDiv);
            btn.disabled = false;
        }
    }

    function handleLocationError(browserHasGeolocation, statusDiv) {
        statusDiv.innerHTML = browserHasGeolocation
            ? "âŒ ç„¡æ³•å–å¾—ä½ç½®ï¼Œè«‹ç¢ºèªç€è¦½å™¨æ¬Šé™æˆ–æ˜¯ä½ çš„GPSå·²é–‹å•Ÿã€‚"
            : "âŒ ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½ã€‚";
    }

    // 3. æœå°‹é™„è¿‘æ™¯é»
    function searchNearbyPlaces(location) {
        service = new google.maps.places.PlacesService(map);
        
        const request = {
            location: location,
            radius: '1500', // æœå°‹åŠå¾‘ 1.5 å…¬é‡Œ
            type: ['tourist_attraction'], // ä¸»è¦æœå°‹æ™¯é»
            // ä½ ä¹Ÿå¯ä»¥åŠ ä¸Š 'park', 'museum', 'aquarium' ç­‰
        };

        service.nearbySearch(request, (results, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                displayResults(results);
            } else {
                document.getElementById('status').innerHTML = "âš ï¸ é™„è¿‘å¥½åƒæ²’ä»€éº¼ç†±é–€æ™¯é»...";
            }
        });
    }

    // 4. é¡¯ç¤ºçµæœä¸¦é€²è¡Œã€Œçˆ¸åª½è¦–è§’åˆ†æã€
    function displayResults(places) {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = ""; // æ¸…ç©ºèˆŠè³‡æ–™
        document.getElementById('status').innerHTML = `ğŸ‰ æ‰¾åˆ° ${places.length} å€‹å¥½å»è™•ï¼`;

        places.forEach(place => {
            // å–å¾—ç…§ç‰‡
            const photoUrl = place.photos 
                ? place.photos[0].getUrl({ maxWidth: 400 }) 
                : null; // ä¹‹å¾Œå¯ä»¥åŠ ä¸Šé è¨­åœ–

            // åˆ¤æ–·ç‡Ÿæ¥­ç‹€æ…‹
            const isOpen = place.opening_hours 
                ? (place.opening_hours.open_now ? "<span class='open-now'>ğŸŸ¢ ç‡Ÿæ¥­ä¸­</span>" : "<span class='closed-now'>ğŸ”´ ä¼‘æ¯ä¸­</span>") 
                : "<span style='color:#999'>ç‡Ÿæ¥­æ™‚é–“æœªçŸ¥</span>";

            // --- ğŸ¤– æ¨¡æ“¬ AI å°éŠåˆ†æ ---
            // ç”±æ–¼ API ä¸æœƒç›´æ¥å›å‚³ "å¥½ä¸å¥½åœè»Š"ï¼Œæˆ‘å€‘ç”¨é¡å‹ä¾†æ¨æ–·å»ºè­°
            let parentAdvice = analyzeForParents(place.types, place.rating);

            // å»ºç«‹å¡ç‰‡ HTML
            const card = document.createElement('div');
            card.className = 'place-card';
            card.innerHTML = `
                <div class="place-header">
                    <h3 class="place-name">${place.name}</h3>
                    ${place.rating ? `<div class="place-rating">â˜… ${place.rating}</div>` : ''}
                </div>
                
                <div class="place-info">
                    ${isOpen} â€¢ ${place.vicinity}
                </div>

                <div class="parent-tips">
                    <strong>ğŸ‘¶ çˆ¸åª½ç­†è¨˜ï¼š</strong>
                    ${parentAdvice}
                </div>

                <div class="tags">
                    ${place.types.slice(0, 3).map(type => `<span class="tag">${formatType(type)}</span>`).join('')}
                </div>
            `;
            
            // é»æ“Šå¡ç‰‡å¯ä»¥åœ¨ Google Map é–‹å•Ÿå°èˆª
            card.onclick = () => {
                window.open(`https://www.google.com/maps/search/?api=1&query=${place.name}&query_place_id=${place.place_id}`, '_blank');
            };

            resultsDiv.appendChild(card);

            // åœ¨åœ°åœ–ä¸ŠåŠ æ¨™è¨˜
            new google.maps.Marker({
                position: place.geometry.location,
                map: map,
                title: place.name
            });
        });
    }

    // --- è¼”åŠ©å‡½å¼ï¼šé‡å°çˆ¸åª½çš„ç°¡æ˜“é‚è¼¯åˆ†æ ---
    function analyzeForParents(types, rating) {
        let advice = "é€™æ˜¯ä¸€å€‹ç†±é–€åœ°é»ï¼Œå»ºè­°å…ˆæŸ¥çœ‹è©³ç´°è©•è«–ã€‚";
        
        if (types.includes('park') || types.includes('amusement_park')) {
            advice = "ğŸ”‹ **è¶…ç´šæ”¾é›»å€ï¼** æˆ¶å¤–ç©ºé–“å¤§ï¼Œè¨˜å¾—å¸¶é˜²èšŠæ¶²å’Œæ°´å£ºã€‚é€šå¸¸é€™é¡åœ°é»æ—é‚Šæœƒæœ‰è·¯é‚Šåœè»Šæ ¼ã€‚";
        } else if (types.includes('museum') || types.includes('art_gallery')) {
            advice = "ğŸ¤« **å®¤å…§è¡Œç¨‹**ï¼Œé©åˆé›¨å¤©å‚™æ¡ˆã€‚è«‹æ³¨æ„é¤¨å…§æ˜¯å¦èƒ½æ¨å¬°å…’è»Šï¼Œå»ºè­°å¸¶å®‰æ’«ç©å…·ã€‚";
        } else if (types.includes('zoo') || types.includes('aquarium')) {
            advice = "ğŸ¦„ **å°å­©æœ€æ„›ï¼** çµ•å°é©åˆå…¨å®¶å‡ºéŠï¼Œå»ºè­°é ç•™ 2-3 å°æ™‚åœç•™æ™‚é–“ã€‚";
        } else if (types.includes('shopping_mall') || types.includes('department_store')) {
            advice = "ğŸš— **åœè»Šæ–¹ä¾¿**ï¼Œé€šå¸¸è¨­æœ‰å“ºä¹³å®¤èˆ‡å°¿å¸ƒå°ï¼Œæ˜¯çˆ¸åª½è£œçµ¦çš„å¥½åœ°æ–¹ã€‚";
        } else if (rating && rating > 4.5) {
            advice = "ğŸŒŸ **é«˜è©•åƒ¹æ™¯é»**ï¼Œäººæ½®å¯èƒ½è¼ƒå¤šï¼Œå»ºè­°é¿é–‹å°–å³°æ™‚æ®µä»¥å…å°å­©èºå‹•ã€‚";
        }

        return advice;
    }

    // ç¿»è­¯é¡åˆ¥åç¨± (è®“ä»‹é¢è®Šä¸­æ–‡)
    function formatType(type) {
        const dict = {
            'point_of_interest': 'æ™¯é»',
            'establishment': 'å ´æ‰€',
            'park': 'å…¬åœ’',
            'tourist_attraction': 'è§€å…‰åå‹',
            'museum': 'åšç‰©é¤¨',
            'restaurant': 'é¤å»³',
            'food': 'ç¾é£Ÿ',
            'store': 'å•†åº—',
            'place_of_worship': 'å®—æ•™å ´æ‰€'
        };
        return dict[type] || type; // å¦‚æœæ²’ç¿»è­¯åˆ°å°±é¡¯ç¤ºåŸæ–‡
    }

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyClFqb1iWGHOvEPNLtA2-lHsQT844C4sqE&libraries=places&callback=initMap" async defer></script>

</body>
</html>
